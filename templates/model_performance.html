{% extends "base.html" %}

{% block title %}Model Performance - TMHNA Financial Intelligence Portal{% endblock %}
{% block breadcrumb %}Model Performance{% endblock %}

{% block content %}
<div class="page-header">
    <h1>AI/ML Model Performance</h1>
    <p class="page-subtitle">Performance metrics, capabilities, and continuous improvement roadmap</p>
</div>

<!-- Model Cards -->
<div class="model-grid">
    <!-- Classification Model -->
    <div class="card">
        <div class="card-header">GL Account Classification</div>
        <div class="card-body">
            <table class="specs-table">
                <tr><td>Model Type</td><td>{{ classifier_metrics.model_type }}</td></tr>
                <tr><td>Features</td><td>{{ classifier_metrics.features }}</td></tr>
                <tr><td>Training Data</td><td>{{ classifier_metrics.training_samples }} samples</td></tr>
                <tr><td>Classes</td><td>{{ classifier_metrics.num_classes }} account categories</td></tr>
                <tr><td>Target Accuracy</td><td>{{ classifier_metrics.accuracy_target }}</td></tr>
            </table>
            
            <div class="metrics-section">
                <h4>Performance Metrics</h4>
                <div class="metrics-grid">
                    <div class="metric-box">
                        <div class="metric-value success">{{ classifier_metrics.precision }}</div>
                        <div class="metric-label">Precision</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-value success">{{ classifier_metrics.recall }}</div>
                        <div class="metric-label">Recall</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-value success">{{ classifier_metrics.f1_score }}</div>
                        <div class="metric-label">F1-Score</div>
                    </div>
                </div>
            </div>
            
            <div class="how-section">
                <h4>How It Works</h4>
                <ol>
                    <li>Transaction descriptions are vectorized using TF-IDF</li>
                    <li>Vendor names add contextual features</li>
                    <li>Random Forest evaluates 100 decision trees</li>
                    <li>Top predictions with confidence scores are returned</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Anomaly Detection Model -->
    <div class="card">
        <div class="card-header">Anomaly Detection</div>
        <div class="card-body">
            <table class="specs-table">
                <tr><td>Model Type</td><td>{{ anomaly_metrics.model_type }}</td></tr>
                <tr><td>Features</td><td>{{ anomaly_metrics.features }}</td></tr>
                <tr><td>Contamination</td><td>{{ anomaly_metrics.contamination_rate }} expected</td></tr>
            </table>
            
            <div class="metrics-section">
                <h4>Detection Capabilities</h4>
                <ul class="capability-list">
                    {% for capability in anomaly_metrics.detection_capability %}
                    <li>{{ capability }}</li>
                    {% endfor %}
                </ul>
            </div>
            
            <div class="how-section">
                <h4>How It Works</h4>
                <ol>
                    <li>Isolation Forest identifies outliers based on features</li>
                    <li>Rule-based checks flag known risk patterns</li>
                    <li>Combined score determines anomaly status</li>
                    <li>Severity levels help prioritize review</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<!-- Roadmap -->
<div class="card">
    <div class="card-header">Continuous Improvement Roadmap</div>
    <div class="card-body">
        <div class="roadmap-grid">
            <div class="roadmap-item">
                <h4>Short-Term (1-3 Months)</h4>
                <ul>
                    {% for item in roadmap.short_term %}
                    <li>{{ item }}</li>
                    {% endfor %}
                </ul>
            </div>
            <div class="roadmap-item">
                <h4>Medium-Term (3-6 Months)</h4>
                <ul>
                    {% for item in roadmap.medium_term %}
                    <li>{{ item }}</li>
                    {% endfor %}
                </ul>
            </div>
            <div class="roadmap-item">
                <h4>Long-Term (6-12 Months)</h4>
                <ul>
                    {% for item in roadmap.long_term %}
                    <li>{{ item }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Technical Stack -->
<div class="card">
    <div class="card-header">Technical Implementation</div>
    <div class="card-body">
        <div class="tech-grid">
            <div class="tech-item">
                <h4>Technology Stack</h4>
                <ul>
                    <li><strong>Framework:</strong> Flask + Jinja2</li>
                    <li><strong>ML Library:</strong> scikit-learn</li>
                    <li><strong>Data Processing:</strong> pandas, NumPy</li>
                    <li><strong>Visualization:</strong> Plotly.js</li>
                </ul>
            </div>
            <div class="tech-item">
                <h4>Model Persistence</h4>
                <ul>
                    <li>Models saved as pickle files</li>
                    <li>Auto-training on first startup</li>
                    <li>Retraining triggered by data updates</li>
                </ul>
            </div>
            <div class="tech-item">
                <h4>Data Sources</h4>
                <ul>
                    <li>SAP ECC (Toyota Material Handling)</li>
                    <li>JD Edwards (Raymond Corporation)</li>
                    <li>IBM iSeries (Legacy systems)</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
