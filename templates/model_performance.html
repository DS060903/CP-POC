{% extends "base.html" %}

{% block title %}Model Performance - TMHNA Financial Intelligence Portal{% endblock %}
{% block breadcrumb %}Model Performance{% endblock %}

{% block content %}
<div class="model-performance">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-content">
            <div class="page-header-left">
                <h1>AI/ML Model Performance</h1>
                <p class="page-subtitle">
                    Performance metrics, capabilities, and continuous improvement roadmap for the Financial Intelligence models
                </p>
            </div>
        </div>
    </div>

    <!-- Intro Card -->
    <div class="card" style="margin-bottom: var(--space-6);">
        <div class="card-body">
            <div class="alert-card alert-info">
                <div class="alert-icon">üí°</div>
                <div class="alert-content">
                    <div class="alert-title">About These Models</div>
                    <div class="alert-message">
                        The TMHNA Financial Intelligence Portal uses machine learning models to automatically classify 
                        journal entries to the unified Chart of Accounts and detect anomalous transactions. This page 
                        provides transparency into model performance and our continuous improvement plans.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Model Cards Grid -->
    <div class="models-grid">
        <!-- Classification Model -->
        <div class="model-card">
            <div class="model-header">
                <div class="model-icon">üìå</div>
                <h2>GL Account Classification</h2>
            </div>
            
            <div class="model-section">
                <div class="model-section-title">Model Specifications</div>
                <div class="specs-grid">
                    <span class="specs-label">Model Type</span>
                    <span class="specs-value">{{ classifier_metrics.model_type }}</span>
                    
                    <span class="specs-label">Features</span>
                    <span class="specs-value">{{ classifier_metrics.features }}</span>
                    
                    <span class="specs-label">Training Data</span>
                    <span class="specs-value">{{ classifier_metrics.training_samples }} samples (demo)</span>
                    
                    <span class="specs-label">Classes</span>
                    <span class="specs-value">{{ classifier_metrics.num_classes }} account categories</span>
                    
                    <span class="specs-label">Target Accuracy</span>
                    <span class="specs-value">{{ classifier_metrics.accuracy_target }}</span>
                </div>
            </div>
            
            <div class="model-section">
                <div class="model-section-title">Performance Metrics</div>
                <div class="metrics-row">
                    <div class="perf-metric">
                        <span class="perf-value">{{ classifier_metrics.precision }}</span>
                        <span class="perf-label">Precision</span>
                    </div>
                    <div class="perf-metric">
                        <span class="perf-value">{{ classifier_metrics.recall }}</span>
                        <span class="perf-label">Recall</span>
                    </div>
                    <div class="perf-metric">
                        <span class="perf-value">{{ classifier_metrics.f1_score }}</span>
                        <span class="perf-label">F1-Score</span>
                    </div>
                </div>
            </div>
            
            <div class="model-section">
                <div class="model-section-title">How It Works</div>
                <ol style="list-style: decimal; padding-left: var(--space-5); font-size: var(--text-sm); color: var(--gray-600); display: flex; flex-direction: column; gap: var(--space-2);">
                    <li>Transaction descriptions are vectorized using TF-IDF</li>
                    <li>Vendor names add contextual features</li>
                    <li>Random Forest evaluates 100 decision trees</li>
                    <li>Top predictions with confidence scores are returned</li>
                </ol>
            </div>
        </div>

        <!-- Anomaly Detection Model -->
        <div class="model-card">
            <div class="model-header">
                <div class="model-icon">üö®</div>
                <h2>Anomaly Detection</h2>
            </div>
            
            <div class="model-section">
                <div class="model-section-title">Model Specifications</div>
                <div class="specs-grid">
                    <span class="specs-label">Model Type</span>
                    <span class="specs-value">{{ anomaly_metrics.model_type }}</span>
                    
                    <span class="specs-label">Features</span>
                    <span class="specs-value">{{ anomaly_metrics.features }}</span>
                    
                    <span class="specs-label">Contamination</span>
                    <span class="specs-value">{{ anomaly_metrics.contamination_rate }} expected</span>
                </div>
            </div>
            
            <div class="model-section">
                <div class="model-section-title">Detection Capabilities</div>
                <ul class="capability-list">
                    {% for capability in anomaly_metrics.detection_capability %}
                    <li>{{ capability }}</li>
                    {% endfor %}
                </ul>
            </div>
            
            <div class="model-section">
                <div class="model-section-title">How It Works</div>
                <ol style="list-style: decimal; padding-left: var(--space-5); font-size: var(--text-sm); color: var(--gray-600); display: flex; flex-direction: column; gap: var(--space-2);">
                    <li>Isolation Forest identifies outliers based on features</li>
                    <li>Rule-based checks flag known risk patterns</li>
                    <li>Combined score determines anomaly status</li>
                    <li>Severity levels help prioritize review</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Roadmap Section -->
    <div class="card" style="margin-bottom: var(--space-6);">
        <div class="card-header">
            <div class="card-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                </svg>
                Continuous Improvement Roadmap
            </div>
        </div>
        <div class="card-body">
            <div class="roadmap-grid">
                <div class="roadmap-card roadmap-short">
                    <div class="roadmap-header">
                        <span class="roadmap-icon">üìÖ</span>
                        <h3>Short-Term (1-3 Months)</h3>
                    </div>
                    <ul class="roadmap-list">
                        {% for item in roadmap.short_term %}
                        <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                </div>
                
                <div class="roadmap-card roadmap-medium">
                    <div class="roadmap-header">
                        <span class="roadmap-icon">üìÜ</span>
                        <h3>Medium-Term (3-6 Months)</h3>
                    </div>
                    <ul class="roadmap-list">
                        {% for item in roadmap.medium_term %}
                        <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                </div>
                
                <div class="roadmap-card roadmap-long">
                    <div class="roadmap-header">
                        <span class="roadmap-icon">üóìÔ∏è</span>
                        <h3>Long-Term (6-12 Months)</h3>
                    </div>
                    <ul class="roadmap-list">
                        {% for item in roadmap.long_term %}
                        <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Technical Implementation -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                </svg>
                Technical Implementation
            </div>
        </div>
        <div class="card-body">
            <div class="tech-grid">
                <div class="tech-card">
                    <h4>Technology Stack</h4>
                    <ul>
                        <li><strong>Framework:</strong> Flask + Jinja2</li>
                        <li><strong>ML Library:</strong> scikit-learn</li>
                        <li><strong>Data Processing:</strong> pandas, NumPy</li>
                        <li><strong>Visualization:</strong> Plotly.js</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>Model Persistence</h4>
                    <ul>
                        <li>Models saved as pickle files</li>
                        <li>Auto-training on first startup</li>
                        <li>Retraining triggered by data updates</li>
                        <li>Version control for model artifacts</li>
                    </ul>
                </div>
                
                <div class="tech-card">
                    <h4>Data Sources</h4>
                    <ul>
                        <li>SAP ECC (Toyota Material Handling)</li>
                        <li>JD Edwards (Raymond Corporation)</li>
                        <li>IBM iSeries (Legacy systems)</li>
                        <li>Unified COA mapping tables</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
